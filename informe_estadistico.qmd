---
title: "Nutrición, Sueño y Salud: Un Análisis Estadístico"
subtitle: "EYP3007 - Consultoría Estadística"
format: 
  pdf: 
    include-in-header: 
      text: |
        \usepackage{amsmath}
    colorlinks: true
    geometry:
      - top=20mm
      - left=20mm
      - right=20mm
      - heightrounded
    fig-pos: H
    classoption: twocolumn
    fontsize: 10pt
author: 
  - name: "Constanza Segovia González"
  - name: "Francisca Vilca Sánchez"
crossref:
  fig-title: Figura
  fig-prefix: figura
  tbl-title: Tabla
  tbl-prefix: tabla
tbl-cap-location: bottom
execute: 
  echo: false
  message: false
  warning: false
---

```{r}
library(rio)
library(dplyr)
library(ggplot2)
library(patchwork)
library(stringr)
library(ggrepel)
library(kableExtra)

```

```{r}
datos <- import("ENS-reducida.xlsx")

datitos <- datos %>% 
  mutate(Edad_Codificada_2 = ifelse(Edad_Codificada == 1,"15 a 24 años",
                                    ifelse(Edad_Codificada == 2, "25 a 44 años",
                                           ifelse(Edad_Codificada == 3, "45 a 64 años","65 años o más")))) %>% 
  mutate(Edad_Codificada_2 = factor(Edad_Codificada_2,
                                    labels = c("15 a 24 años",
                                               "25 a 44 años",
                                               "45 a 64 años",
                                               "65 años o más")) ) %>% 
  mutate(AREA_2 = factor(AREA,
                         labels = c("Norte",
                                    "Centro",
                                    "RM",
                                    "C-Sur",
                                    "Sur")) ) %>% 
  select(c(1:6),c(27:38),c(66:76),143,144)

datitos2 <-  datitos %>%
  mutate(Sexo_2 = ifelse(Sexo == 1,"Masculino","Femenino")) %>% 
  mutate(Nivel_Educ_2 = ifelse(Nivel_Educ == 1,"Bajo",
                               ifelse(Nivel_Educ == 2, "Medio","Alto"))) %>% 
  mutate(Nivel_Educ_2 = factor(Nivel_Educ_2,
                               labels = c("Bajo",
                                          "Medio",
                                          "Alto")) ) %>% 
  mutate(horas_suegno_sem = ifelse(ts5 <= 5, "Menos o 5 horas",
                                   ifelse(5 < ts5 & ts5 <= 10,
                                          "Entre 5 a 10 horas",
                                          "Más de 10 horas"))) %>% 
  mutate(horas_suegno_fds = ifelse(ts6 <= 5, "Menos o 5 horas",
                                   ifelse(5<ts6 & ts6 <= 10,"Entre 5 a 10 horas",
                                          "Más de 10 horas"))) %>% 
  mutate(est_nut = factor(est_nut, 
                          levels = c(1, 0, 3, 4, 5), 
                          labels = c("Enflaquecido","Normal", "Sobrepeso",
                                     "Obeso", "Obeso mórbido")),
         trastorno_suegno = factor(trastorno_suegno, levels = c(0, 1)),
         sospecha_apnea = factor(sospecha_apnea, levels = c(0, 1)),
         horas_suegno_fds = factor(horas_suegno_fds,
                                   levels = c("Menos o 5 horas",
                                              "Entre 5 a 10 horas",
                                              "Más de 10 horas")),
         horas_suegno_sem = factor(horas_suegno_sem,
                                   levels = c("Menos o 5 horas",
                                              "Entre 5 a 10 horas",
                                              "Más de 10 horas"))) %>%
  na.omit() %>% 
  select(2,4,6,11,12,c(17:20),c(23:25),28,29,c(32:35))

```

## Introducción

La Encuesta Nacional de Salud (ENS) emerge como un recurso invaluable para el país en su búsqueda de comprender las enfermedades no transmisibles y los factores de riesgo asociados. Es una herramienta fundamental que proporciona al Ministerio de Salud una instantánea actualizada para evaluar políticas, anticipar la demanda del sistema sanitario y establecer medidas de vigilancia epidemiológica. 

El presente informe tiene como objetivo analizar dos temas específicos evaluados por la ENS: los **Trastornos del Sueño** y el **Estado Nutricional**. Se enfocará en buscar una posible relación entre ambos aspectos de la salud. El Estado Nutricional, detalladamente subdividido en categorías que incluyen el Índice de Masa Corporal (IMC), Peso, Talla, Circunferencia de Cintura y Cuello, entre otros, proporciona una clasificación exhaustiva que abarca desde "Normal" hasta "Obeso mórbido". Por otro lado, el Trastorno del Sueño, tambien esta subdivido en categorías que destacan la cantidad de horas que duerme una persona, si tiene sospecha de apnea o de trastorno del sueño, según la respuesta a diferentes preguntas.

El objetivo de este análisis es explorar la interacción entre estos dos dominios de la salud, identificando posibles correlaciones y brindando una visión más completa de su impacto en la población. Para ello, primero revisaremos los datos generales que poseemos de la muestra extraída y luego las características de cada tema. A continuación, revisaremos la relación entre ambas variables, para comprobar la relación entre ambas. Finalmente concluir en base a los resultados obtenidos.

## Datos de la muestra

Como se mencionó anteriormente, para la creación de este trabajo se utiliza una muestra con `r nrow(datos)` individuos. Sin embargo, dado que existen datos faltantes dentro de la muestra a trabajar para las categorías que se van a utilizar, finalmente se usará una base con `r nrow(datitos2)` individuos. Con esta muestra se pueden revisar algunas características a nivel general como:

- Edad: En la @tbl-t1, es posible observar que la muestra se concentra principalmente en individuos entre 25 a 44 años y 45 a 64 años.

```{r}
#| label: tbl-t1

datitos %>% 
  group_by(Edad_Codificada_2) %>% 
  summarise(Cantidad = n()) %>% 
  mutate(Porcentaje = round(Cantidad / sum(Cantidad) * 100,2)) %>% 
  select(1,3) %>% 
  kable(digits = 2, align = "c",booktabs = TRUE,
        col.names = c("Edad","Porcentaje"),
        format.args=list(decimal.mark=',', big.mark = '.')) %>%
  kable_minimal()  %>%
  kable_styling(full_width = FALSE)
```

- Nivel Educacional: En la @tbl-t2, vemos que la muestra presenta enn general un nivel Alto de Educación que, es decir más de 12 años estudiando.

```{r}
#| label: tbl-t2

datitos2 %>%
  group_by(Nivel_Educ_2) %>% 
  summarise(Cantidad = n()) %>% 
  mutate(Porcentaje = round(Cantidad / sum(Cantidad) * 100,2)) %>% 
  select(1,3) %>% 
  kable(digits = 2, align = "c",booktabs = TRUE,
        col.names = c("Nivel Educacional", "Porcentaje"),
        format.args=list(decimal.mark=',', big.mark = '.')) %>%
  kable_minimal()  %>%
  kable_styling(full_width = FALSE)
```

- Zona Geográfica: lo mismo q con el otro

```{r}
#| label: tbl-t3

datitos %>%
  group_by(AREA_2) %>% 
  summarise(Cantidad = n()) %>% 
  mutate(Porcentaje = round(Cantidad / sum(Cantidad) * 100,2)) %>% 
  select(1,3) %>% 
  kable(digits = 2, align = "c",booktabs = TRUE,
        col.names = c("Área", "Porcentaje"),
        format.args=list(decimal.mark=',', big.mark = '.')) %>%
  kable_minimal()  %>%
  kable_styling(full_width = FALSE)
```

- Sexo: le pondria género pero el profe 

```{r}
#| label: tbl-t4

# 1=Masculino  2=Femenino

datitos2 %>% 
  mutate(Sexo_2 = ifelse(Sexo == 1,"Masculino","Femenino")) %>% 
  group_by(Sexo_2) %>% 
  summarise(Cantidad = n()) %>% 
  mutate(Porcentaje = round(Cantidad / sum(Cantidad) * 100,2)) %>% 
  select(1,3) %>% 
  kable(digits = 2, align = "c",booktabs = TRUE,
        col.names = c("Sexo","Porcentaje"),
        format.args=list(decimal.mark=',', big.mark = '.')) %>%
  kable_minimal() %>%
  kable_styling(full_width = FALSE)
```


## Trastorno del Sueño

Los trastornos del sueño abarcan una variedad de alteraciones en los patrones de descanso, y según la Organización Mundial de la Salud (OMS), afectan a casi el 40% de la población. En este contexto, resulta de gran interés comprender cómo impactan en la población chilena mayor de 15 años. Para abordar esto, se analizarán los resultados obtenidos a partir de la muestra recolectada por la ENS.

### Horas de Sueño:

Para comenzar el análisis, se realizará una comparación entre las horas de sueño en la semana y las horas de sueño el fin de semana del total de la población encuestada. 

```{r}
#| label: fig-f1
#| fig-cap: "titulo"

ggplot() +
  geom_histogram(data = datitos2, aes(x = ts5, fill = "Horas de sueño en la semana"), alpha = 0.7, color = "white", bins = 20) +
  geom_histogram(data = datitos2, aes(x = ts6, fill = "Horas de sueño el fin de semana"), alpha = 0.7, color = "white", bins = 20) +
  labs(title = "Horas de sueño en la semana y el fin de semana por individuo",
       x = "Horas promedio de sueño",
       y = "Cantidad") +
  scale_x_continuous(limits = c(0, max(max(datitos2$ts5), max(datitos2$ts6)) + 1), breaks = seq(0, max(max(datitos2$ts5), max(datitos2$ts6)) + 1, 1)) +
  scale_fill_manual(name = "Variables",
                    values = c("Horas de sueño en la semana" = "maroon",
                               "Horas de sueño el fin de semana" = "#FF6A6A")) +
  theme_minimal() +
  theme(legend.position = "bottom")

```

El gráfico revela que la mayoría de la población, tanto durante la semana como los fines de semana, duerme alrededor de 8 horas. Esto sugiere que hay una tendencia generalizada hacia un patrón de sueño de aproximadamente 8 horas por noche en la población estudiada. Sin embargo, se observa que durante el fin de semana, hay un aumento en el número de horas de sueño en comparación con los días laborales. Este fenómeno es común y refleja la práctica extendida de "compensar" el sueño perdido durante la semana laboral mediante un mayor descanso durante los fines de semana.

### Trastorno del Sueño 

```{r}
#| label: fig-f2
#| fig-cap: "titulo2"

datitos2 %>% 
  group_by(trastorno_suegno) %>% 
  summarise(Cantidad = n()) %>% 
  mutate(Porcentaje = round(Cantidad / sum(Cantidad) * 100,2)) %>%  
  ggplot(aes(x="",y=Porcentaje, fill= trastorno_suegno))+
  geom_bar(stat = "identity",
           color="white") +
  geom_text(aes(label = str_glue("{format(Porcentaje, big.mark = '.', decimal.mark = ',')}%")),
            position=position_stack(vjust=0.5),color="black",size=5)+
  coord_polar(theta = "y")+
  labs(x = "",
       y = "",
       fill = "¿Hay trastorno del sueño?") +
  scale_fill_manual(values = c("#F72C25", "#65E317")
                    ,labels = c("No", "Si")
                    )+
  theme_minimal()
  
```

### Sospecha de Apnea

```{r}
#| label: fig-f3
#| fig-cap: "titulo3"

datitos2 %>% 
  group_by(sospecha_apnea) %>% 
  summarise(Cantidad = n()) %>% 
  mutate(Porcentaje = round(Cantidad / sum(Cantidad) * 100,2)) %>%  
  ggplot(aes(x="",y=Porcentaje, fill= sospecha_apnea))+
  geom_bar(stat = "identity",
           color="white") +
  geom_text(aes(label = str_glue("{format(Porcentaje, big.mark = '.', decimal.mark = ',')}%")),
            position=position_stack(vjust=0.5),color="black",size=5)+
  coord_polar(theta = "y")+
  labs(x = "",
       y = "",
       fill = "¿Hay Sospecha de Apnea?")+
  scale_fill_manual(values = c("#F72C25", "#65E317"),
                    labels = c("Sin sospecha", "Con sospecha"))+
  theme_minimal()
```

## Estado Nutricional

```{r}
#| label: fig-f4
#| fig-cap: "titulo4"

datos_nut <- datitos2 %>%
  filter(est_nut %in% c("Enflaquecido", "Normal", "Sobrepeso", "Obeso", "Obeso mórbido"))

datos_nut %>% 
  group_by(est_nut) %>% 
  summarise(Cantidad = n()) %>% 
  mutate(Porcentaje = round(Cantidad / sum(Cantidad) * 100,2)) %>% 
  ggplot(aes(x="",y=Porcentaje, fill= est_nut))+
  geom_bar(stat = "identity",
           color="white") +
  geom_text_repel(aes(label = str_glue("{format(Porcentaje, big.mark = '.', decimal.mark = ',')}%")), 
                  direction = "both", segment.color = "transparent", 
                  segment.size = 0, force = 5, color = "black", size = 5) +
  coord_polar(theta = "y")+
  labs(x = "",
       y = "",
       fill = "Estado Nutricional")+
  scale_fill_manual(values = c("#F72C25", "#FFBE0B", "#65E317",
                               "#124FB3","#822E81"))+
  theme_minimal()

```

## Relaciones entre Estado Nutricional y Trastorrno del sueño:

```{r}

ggplot(datitos2, aes(x = est_nut, fill=trastorno_suegno)) +
  geom_bar(aes(fill = trastorno_suegno), position = "dodge") +
  scale_fill_manual(values = c("pink", "#FF69B4"), labels = c("Sin trastorno", "Con trastorno")) + 
  labs(title = "Estado Nutricional con Trastorno de Sueño",
       x = " ",
       y = " ",
       fill=" ")+
  theme_minimal()

```


## Conclusiones

algo debemos haber creado

## Bibliografía 

no se q wea poner de relleno aca pero debe estar en apa
yo cito en apa, mi mejor skill :D

- https://www.mendoza.gov.ar/prensa/trastornos-del-sueno-y-sus-consecuencias-dormir-no-es-descansar/#:~:text=Se%20denomina%20trastornos%20del%20sue%C3%B1o,a%20cabo%20un%20buen%20dormir.

LOS ANEXOOOOOS DEBERIAN IR AQUÍ